<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Search Autocomplete</title>
    <!-- Included some basic styling, change at will -->
    <link rel="stylesheet" type="text/css" href="https://cdn.rawgit.com/prampcontent/3ea04cbd0f61a798e96afbe5d31ec2f9/raw/e879e32222b543b29a168daa089e2f9f28cf9eb2/autocomplete.css">
<body>
<form class="search-form">
    <input type="text" class="search-input" placeholder="Start typing a movie title...">
    <ul class="results"></ul>
</form>
<!-- Helper code to provide a search API for mock data -->
<script src="https://cdn.rawgit.com/prampcontent/180077452f9279073cab1035f60d30cf/raw/9cbf891a80bad9ad09c6261ef9578a65502922cc/search_helper.js"></script>
<script>
    /*-------------------------------
    *
    * Write your JavaScript code here.
    *
    * The mocked search data is available using the searchData async method, e.g:
    *   searchData("QUERY").then(results => ...)
    * ------------------------------*/
    // Get HTML elements
  const searchInputElement = document.querySelector('.search-input');
  const resultsElement = document.querySelector('.results');

  function memoize(fn) {
    const cache = new Map();
    return function(arg) {
      const key = arg;
      console.log(key);
      if (cache.get(key)) {
        console.log('cache hit');
        render(cache.get(key));
        return;
      }
      console.log('cache missing');
      const val = fn.apply(this, arguments);
      cache.set(key, val);
    }
  }

  showSearchResults = memoize(showSearchResults);


  // Pass
  function handleChange() {
      return showSearchResults(this.value);
  }

  // Register for both events
  // searchInputElement.addEventListener('change', handleChange);
  // searchInputElement.addEventListener('keyup', handleChange);
  searchInputElement.addEventListener('input', handleChange);

  function render(input) {
    resultsElement.innerHTML = input;
  }

  // Convert search results into UI suggestions
  function showSearchResults(searchQuery) {
      searchData(searchQuery).then(results => {
          const html = results.map(movie => `
            <li>
              <span class="title">${movie.title}</span>
              <span class="rating">${movie.rating}</span>
            </li>
          `);

          render(html.join(''));
      });

    return resultsElement.innerHTML;
  }


</script>
</body>
</html>
